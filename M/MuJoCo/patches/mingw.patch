From 1fcc83d77639a4c0d52bf9f5ad396aa3d5aae4b0 Mon Sep 17 00:00:00 2001
From: Jamie Mair <JamieMair@users.noreply.github.com>
Date: Fri, 18 Aug 2023 11:43:38 +0100
Subject: [PATCH 1/1] patch to allow for cross-compilation using mingw

---
 cmake/MujocoOptions.cmake         |   1 -
 dist/mujoco.rc                    |   2 +-
 dist/simulate.rc                  |   2 +-
 sample/Makefile                   | 468 +++++++++++++++++++++++++++++-
 simulate/Makefile                 | 398 ++++++++++++++++++++++++-
 src/engine/engine_crossplatform.h |  10 +-
 src/engine/engine_util_errmem.c   |   8 +-
 test/fixture.cc                   |   2 +-
 8 files changed, 856 insertions(+), 35 deletions(-)

diff --git a/cmake/MujocoOptions.cmake b/cmake/MujocoOptions.cmake
index 998b966..213f422 100644
--- a/cmake/MujocoOptions.cmake
+++ b/cmake/MujocoOptions.cmake
@@ -86,7 +86,6 @@ get_mujoco_extra_link_options(EXTRA_LINK_OPTIONS)
 
 if(CMAKE_CXX_COMPILER_ID STREQUAL "GNU" OR (CMAKE_CXX_COMPILER_ID MATCHES "Clang" AND NOT MSVC))
   set(EXTRA_COMPILE_OPTIONS
-      -Werror
       -Wall
       -Wimplicit-fallthrough
       -Wunused
diff --git a/dist/mujoco.rc b/dist/mujoco.rc
index 4691253..9fb8faf 100644
--- a/dist/mujoco.rc
+++ b/dist/mujoco.rc
@@ -20,6 +20,6 @@ FILETYPE 0x1
   }
   BLOCK "VarFileInfo"
   {
-    VALUE "Translation", 0x0409 0x04B0
+    VALUE "Translation", 0x0409, 0x04B0
   }
 }
diff --git a/dist/simulate.rc b/dist/simulate.rc
index 16ba684..194a137 100644
--- a/dist/simulate.rc
+++ b/dist/simulate.rc
@@ -22,6 +22,6 @@ FILETYPE 0x1
   }
   BLOCK "VarFileInfo"
   {
-    VALUE "Translation", 0x0409 0x04B0
+    VALUE "Translation", 0x0409, 0x04B0
   }
 }
diff --git a/sample/Makefile b/sample/Makefile
index d51b154..d4c67b5 100644
--- a/sample/Makefile
+++ b/sample/Makefile
@@ -1,14 +1,454 @@
-# This Makefile assumes that you have GLFW libraries and headers installed on,
-# which is commonly available through your distro's package manager.
-# On Debian and Ubuntu, GLFW can be installed via `apt install libglfw3-dev`.
-
-COMMON=-O2 -I../include -L../lib -std=c++17 -pthread -Wl,-no-as-needed -Wl,-rpath,'$$ORIGIN'/../lib
-
-.PHONY: all
-all:
-	$(CXX) $(COMMON) testxml.cc            -lmujoco          -o ../bin/testxml
-	$(CXX) $(COMMON) testspeed.cc          -lmujoco          -o ../bin/testspeed
-	$(CXX) $(COMMON) compile.cc            -lmujoco          -o ../bin/compile
-	$(CXX) $(COMMON) derivative.cc         -lmujoco -fopenmp -o ../bin/derivative
-	$(CXX) $(COMMON) basic.cc              -lmujoco -lglfw   -o ../bin/basic
-	$(CXX) $(COMMON) record.cc             -lmujoco -lglfw   -o ../bin/record
+# CMAKE generated file: DO NOT EDIT!
+# Generated by "Unix Makefiles" Generator, CMake Version 3.21
+
+# Default target executed when no arguments are given to make.
+default_target: all
+.PHONY : default_target
+
+# Allow only one "make -f Makefile2" at a time, but pass parallelism.
+.NOTPARALLEL:
+
+#=============================================================================
+# Special targets provided by cmake.
+
+# Disable implicit rules so canonical targets will work.
+.SUFFIXES:
+
+# Disable VCS-based implicit rules.
+% : %,v
+
+# Disable VCS-based implicit rules.
+% : RCS/%
+
+# Disable VCS-based implicit rules.
+% : RCS/%,v
+
+# Disable VCS-based implicit rules.
+% : SCCS/s.%
+
+# Disable VCS-based implicit rules.
+% : s.%
+
+.SUFFIXES: .hpux_make_needs_suffix_list
+
+# Command-line flag to silence nested $(MAKE).
+$(VERBOSE)MAKESILENT = -s
+
+#Suppress display of executed commands.
+$(VERBOSE).SILENT:
+
+# A target that is always out of date.
+cmake_force:
+.PHONY : cmake_force
+
+#=============================================================================
+# Set environment variables for the build.
+
+# The shell in which to execute make rules.
+SHELL = /bin/sh
+
+# The CMake executable.
+CMAKE_COMMAND = /usr/bin/cmake
+
+# The command to remove a file.
+RM = /usr/bin/cmake -E rm -f
+
+# Escaping for special characters.
+EQUALS = =
+
+# The top-level source directory on which CMake was run.
+CMAKE_SOURCE_DIR = /workspace/srcdir/mujoco
+
+# The top-level build directory on which CMake was run.
+CMAKE_BINARY_DIR = /workspace/srcdir/mujoco
+
+#=============================================================================
+# Targets provided globally by CMake.
+
+# Special rule for the target install/strip
+install/strip: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip
+
+# Special rule for the target install/strip
+install/strip/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip/fast
+
+# Special rule for the target install/local
+install/local: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local
+
+# Special rule for the target install/local
+install/local/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local/fast
+
+# Special rule for the target install
+install: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/bin/cmake -P cmake_install.cmake
+.PHONY : install
+
+# Special rule for the target install
+install/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/bin/cmake -P cmake_install.cmake
+.PHONY : install/fast
+
+# Special rule for the target list_install_components
+list_install_components:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Available install components are: \"Devel\" \"Unspecified\" \"dev\" \"runtime\" \"samples\" \"simulate\" \"tinyxml2_development\""
+.PHONY : list_install_components
+
+# Special rule for the target list_install_components
+list_install_components/fast: list_install_components
+.PHONY : list_install_components/fast
+
+# Special rule for the target rebuild_cache
+rebuild_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake to regenerate build system..."
+	/usr/bin/cmake --regenerate-during-build -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : rebuild_cache
+
+# Special rule for the target rebuild_cache
+rebuild_cache/fast: rebuild_cache
+.PHONY : rebuild_cache/fast
+
+# Special rule for the target edit_cache
+edit_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake cache editor..."
+	/usr/bin/ccmake -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : edit_cache
+
+# Special rule for the target edit_cache
+edit_cache/fast: edit_cache
+.PHONY : edit_cache/fast
+
+# Special rule for the target test
+test:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running tests..."
+	/usr/bin/ctest --force-new-ctest-process $(ARGS)
+.PHONY : test
+
+# Special rule for the target test
+test/fast: test
+.PHONY : test/fast
+
+# The main all target
+all: cmake_check_build_system
+	cd /workspace/srcdir/mujoco && $(CMAKE_COMMAND) -E cmake_progress_start /workspace/srcdir/mujoco/CMakeFiles /workspace/srcdir/mujoco/sample//CMakeFiles/progress.marks
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 sample/all
+	$(CMAKE_COMMAND) -E cmake_progress_start /workspace/srcdir/mujoco/CMakeFiles 0
+.PHONY : all
+
+# The main clean target
+clean:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 sample/clean
+.PHONY : clean
+
+# The main clean target
+clean/fast: clean
+.PHONY : clean/fast
+
+# Prepare targets for installation.
+preinstall: all
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 sample/preinstall
+.PHONY : preinstall
+
+# Prepare targets for installation.
+preinstall/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 sample/preinstall
+.PHONY : preinstall/fast
+
+# clear depends
+depend:
+	cd /workspace/srcdir/mujoco && $(CMAKE_COMMAND) -P /workspace/srcdir/mujoco/CMakeFiles/VerifyGlobs.cmake
+	cd /workspace/srcdir/mujoco && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 1
+.PHONY : depend
+
+# Convenience name for target.
+sample/CMakeFiles/basic.dir/rule:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 sample/CMakeFiles/basic.dir/rule
+.PHONY : sample/CMakeFiles/basic.dir/rule
+
+# Convenience name for target.
+basic: sample/CMakeFiles/basic.dir/rule
+.PHONY : basic
+
+# fast build rule for target.
+basic/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/basic.dir/build.make sample/CMakeFiles/basic.dir/build
+.PHONY : basic/fast
+
+# Convenience name for target.
+sample/CMakeFiles/testxml.dir/rule:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 sample/CMakeFiles/testxml.dir/rule
+.PHONY : sample/CMakeFiles/testxml.dir/rule
+
+# Convenience name for target.
+testxml: sample/CMakeFiles/testxml.dir/rule
+.PHONY : testxml
+
+# fast build rule for target.
+testxml/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/testxml.dir/build.make sample/CMakeFiles/testxml.dir/build
+.PHONY : testxml/fast
+
+# Convenience name for target.
+sample/CMakeFiles/record.dir/rule:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 sample/CMakeFiles/record.dir/rule
+.PHONY : sample/CMakeFiles/record.dir/rule
+
+# Convenience name for target.
+record: sample/CMakeFiles/record.dir/rule
+.PHONY : record
+
+# fast build rule for target.
+record/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/record.dir/build.make sample/CMakeFiles/record.dir/build
+.PHONY : record/fast
+
+# Convenience name for target.
+sample/CMakeFiles/testspeed.dir/rule:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 sample/CMakeFiles/testspeed.dir/rule
+.PHONY : sample/CMakeFiles/testspeed.dir/rule
+
+# Convenience name for target.
+testspeed: sample/CMakeFiles/testspeed.dir/rule
+.PHONY : testspeed
+
+# fast build rule for target.
+testspeed/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/testspeed.dir/build.make sample/CMakeFiles/testspeed.dir/build
+.PHONY : testspeed/fast
+
+# Convenience name for target.
+sample/CMakeFiles/derivative.dir/rule:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 sample/CMakeFiles/derivative.dir/rule
+.PHONY : sample/CMakeFiles/derivative.dir/rule
+
+# Convenience name for target.
+derivative: sample/CMakeFiles/derivative.dir/rule
+.PHONY : derivative
+
+# fast build rule for target.
+derivative/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/derivative.dir/build.make sample/CMakeFiles/derivative.dir/build
+.PHONY : derivative/fast
+
+# Convenience name for target.
+sample/CMakeFiles/compile.dir/rule:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 sample/CMakeFiles/compile.dir/rule
+.PHONY : sample/CMakeFiles/compile.dir/rule
+
+# Convenience name for target.
+compile: sample/CMakeFiles/compile.dir/rule
+.PHONY : compile
+
+# fast build rule for target.
+compile/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/compile.dir/build.make sample/CMakeFiles/compile.dir/build
+.PHONY : compile/fast
+
+basic.obj: basic.cc.obj
+.PHONY : basic.obj
+
+# target to build an object file
+basic.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/basic.dir/build.make sample/CMakeFiles/basic.dir/basic.cc.obj
+.PHONY : basic.cc.obj
+
+basic.i: basic.cc.i
+.PHONY : basic.i
+
+# target to preprocess a source file
+basic.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/basic.dir/build.make sample/CMakeFiles/basic.dir/basic.cc.i
+.PHONY : basic.cc.i
+
+basic.s: basic.cc.s
+.PHONY : basic.s
+
+# target to generate assembly for a file
+basic.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/basic.dir/build.make sample/CMakeFiles/basic.dir/basic.cc.s
+.PHONY : basic.cc.s
+
+compile.obj: compile.cc.obj
+.PHONY : compile.obj
+
+# target to build an object file
+compile.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/compile.dir/build.make sample/CMakeFiles/compile.dir/compile.cc.obj
+.PHONY : compile.cc.obj
+
+compile.i: compile.cc.i
+.PHONY : compile.i
+
+# target to preprocess a source file
+compile.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/compile.dir/build.make sample/CMakeFiles/compile.dir/compile.cc.i
+.PHONY : compile.cc.i
+
+compile.s: compile.cc.s
+.PHONY : compile.s
+
+# target to generate assembly for a file
+compile.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/compile.dir/build.make sample/CMakeFiles/compile.dir/compile.cc.s
+.PHONY : compile.cc.s
+
+derivative.obj: derivative.cc.obj
+.PHONY : derivative.obj
+
+# target to build an object file
+derivative.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/derivative.dir/build.make sample/CMakeFiles/derivative.dir/derivative.cc.obj
+.PHONY : derivative.cc.obj
+
+derivative.i: derivative.cc.i
+.PHONY : derivative.i
+
+# target to preprocess a source file
+derivative.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/derivative.dir/build.make sample/CMakeFiles/derivative.dir/derivative.cc.i
+.PHONY : derivative.cc.i
+
+derivative.s: derivative.cc.s
+.PHONY : derivative.s
+
+# target to generate assembly for a file
+derivative.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/derivative.dir/build.make sample/CMakeFiles/derivative.dir/derivative.cc.s
+.PHONY : derivative.cc.s
+
+record.obj: record.cc.obj
+.PHONY : record.obj
+
+# target to build an object file
+record.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/record.dir/build.make sample/CMakeFiles/record.dir/record.cc.obj
+.PHONY : record.cc.obj
+
+record.i: record.cc.i
+.PHONY : record.i
+
+# target to preprocess a source file
+record.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/record.dir/build.make sample/CMakeFiles/record.dir/record.cc.i
+.PHONY : record.cc.i
+
+record.s: record.cc.s
+.PHONY : record.s
+
+# target to generate assembly for a file
+record.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/record.dir/build.make sample/CMakeFiles/record.dir/record.cc.s
+.PHONY : record.cc.s
+
+testspeed.obj: testspeed.cc.obj
+.PHONY : testspeed.obj
+
+# target to build an object file
+testspeed.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/testspeed.dir/build.make sample/CMakeFiles/testspeed.dir/testspeed.cc.obj
+.PHONY : testspeed.cc.obj
+
+testspeed.i: testspeed.cc.i
+.PHONY : testspeed.i
+
+# target to preprocess a source file
+testspeed.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/testspeed.dir/build.make sample/CMakeFiles/testspeed.dir/testspeed.cc.i
+.PHONY : testspeed.cc.i
+
+testspeed.s: testspeed.cc.s
+.PHONY : testspeed.s
+
+# target to generate assembly for a file
+testspeed.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/testspeed.dir/build.make sample/CMakeFiles/testspeed.dir/testspeed.cc.s
+.PHONY : testspeed.cc.s
+
+testxml.obj: testxml.cc.obj
+.PHONY : testxml.obj
+
+# target to build an object file
+testxml.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/testxml.dir/build.make sample/CMakeFiles/testxml.dir/testxml.cc.obj
+.PHONY : testxml.cc.obj
+
+testxml.i: testxml.cc.i
+.PHONY : testxml.i
+
+# target to preprocess a source file
+testxml.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/testxml.dir/build.make sample/CMakeFiles/testxml.dir/testxml.cc.i
+.PHONY : testxml.cc.i
+
+testxml.s: testxml.cc.s
+.PHONY : testxml.s
+
+# target to generate assembly for a file
+testxml.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f sample/CMakeFiles/testxml.dir/build.make sample/CMakeFiles/testxml.dir/testxml.cc.s
+.PHONY : testxml.cc.s
+
+# Help Target
+help:
+	@echo "The following are some of the valid targets for this Makefile:"
+	@echo "... all (the default if no target is provided)"
+	@echo "... clean"
+	@echo "... depend"
+	@echo "... edit_cache"
+	@echo "... install"
+	@echo "... install/local"
+	@echo "... install/strip"
+	@echo "... list_install_components"
+	@echo "... rebuild_cache"
+	@echo "... test"
+	@echo "... basic"
+	@echo "... compile"
+	@echo "... derivative"
+	@echo "... record"
+	@echo "... testspeed"
+	@echo "... testxml"
+	@echo "... basic.obj"
+	@echo "... basic.i"
+	@echo "... basic.s"
+	@echo "... compile.obj"
+	@echo "... compile.i"
+	@echo "... compile.s"
+	@echo "... derivative.obj"
+	@echo "... derivative.i"
+	@echo "... derivative.s"
+	@echo "... record.obj"
+	@echo "... record.i"
+	@echo "... record.s"
+	@echo "... testspeed.obj"
+	@echo "... testspeed.i"
+	@echo "... testspeed.s"
+	@echo "... testxml.obj"
+	@echo "... testxml.i"
+	@echo "... testxml.s"
+.PHONY : help
+
+
+
+#=============================================================================
+# Special targets to cleanup operation of make.
+
+# Special rule to run CMake to check the build system integrity.
+# No rule that depends on this can have commands that come from listfiles
+# because they might be regenerated.
+cmake_check_build_system:
+	cd /workspace/srcdir/mujoco && $(CMAKE_COMMAND) -P /workspace/srcdir/mujoco/CMakeFiles/VerifyGlobs.cmake
+	cd /workspace/srcdir/mujoco && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 0
+.PHONY : cmake_check_build_system
+
diff --git a/simulate/Makefile b/simulate/Makefile
index f0834cb..07611b9 100644
--- a/simulate/Makefile
+++ b/simulate/Makefile
@@ -1,11 +1,391 @@
-# This Makefile assumes that you have GLFW libraries and headers installed on,
-# which is commonly available through your distro's package manager.
-# On Debian and Ubuntu, GLFW can be installed via `apt install libglfw3-dev`.
+# CMAKE generated file: DO NOT EDIT!
+# Generated by "Unix Makefiles" Generator, CMake Version 3.21
 
-COMMON=-O2 -I../include -L../lib -pthread -Wl,-no-as-needed -Wl,-rpath,'$$ORIGIN'/../lib
+# Default target executed when no arguments are given to make.
+default_target: all
+.PHONY : default_target
+
+# Allow only one "make -f Makefile2" at a time, but pass parallelism.
+.NOTPARALLEL:
+
+#=============================================================================
+# Special targets provided by cmake.
+
+# Disable implicit rules so canonical targets will work.
+.SUFFIXES:
+
+# Disable VCS-based implicit rules.
+% : %,v
+
+# Disable VCS-based implicit rules.
+% : RCS/%
+
+# Disable VCS-based implicit rules.
+% : RCS/%,v
+
+# Disable VCS-based implicit rules.
+% : SCCS/s.%
+
+# Disable VCS-based implicit rules.
+% : s.%
+
+.SUFFIXES: .hpux_make_needs_suffix_list
+
+# Command-line flag to silence nested $(MAKE).
+$(VERBOSE)MAKESILENT = -s
+
+#Suppress display of executed commands.
+$(VERBOSE).SILENT:
+
+# A target that is always out of date.
+cmake_force:
+.PHONY : cmake_force
+
+#=============================================================================
+# Set environment variables for the build.
+
+# The shell in which to execute make rules.
+SHELL = /bin/sh
+
+# The CMake executable.
+CMAKE_COMMAND = /usr/bin/cmake
+
+# The command to remove a file.
+RM = /usr/bin/cmake -E rm -f
+
+# Escaping for special characters.
+EQUALS = =
+
+# The top-level source directory on which CMake was run.
+CMAKE_SOURCE_DIR = /workspace/srcdir/mujoco
+
+# The top-level build directory on which CMake was run.
+CMAKE_BINARY_DIR = /workspace/srcdir/mujoco
+
+#=============================================================================
+# Targets provided globally by CMake.
+
+# Special rule for the target install/strip
+install/strip: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip
+
+# Special rule for the target install/strip
+install/strip/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing the project stripped..."
+	/usr/bin/cmake -DCMAKE_INSTALL_DO_STRIP=1 -P cmake_install.cmake
+.PHONY : install/strip/fast
+
+# Special rule for the target install/local
+install/local: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local
+
+# Special rule for the target install/local
+install/local/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Installing only the local directory..."
+	/usr/bin/cmake -DCMAKE_INSTALL_LOCAL_ONLY=1 -P cmake_install.cmake
+.PHONY : install/local/fast
+
+# Special rule for the target install
+install: preinstall
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/bin/cmake -P cmake_install.cmake
+.PHONY : install
+
+# Special rule for the target install
+install/fast: preinstall/fast
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Install the project..."
+	/usr/bin/cmake -P cmake_install.cmake
+.PHONY : install/fast
+
+# Special rule for the target list_install_components
+list_install_components:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Available install components are: \"Devel\" \"Unspecified\" \"dev\" \"runtime\" \"samples\" \"simulate\" \"tinyxml2_development\""
+.PHONY : list_install_components
+
+# Special rule for the target list_install_components
+list_install_components/fast: list_install_components
+.PHONY : list_install_components/fast
+
+# Special rule for the target rebuild_cache
+rebuild_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake to regenerate build system..."
+	/usr/bin/cmake --regenerate-during-build -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : rebuild_cache
+
+# Special rule for the target rebuild_cache
+rebuild_cache/fast: rebuild_cache
+.PHONY : rebuild_cache/fast
+
+# Special rule for the target edit_cache
+edit_cache:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake cache editor..."
+	/usr/bin/ccmake -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : edit_cache
+
+# Special rule for the target edit_cache
+edit_cache/fast: edit_cache
+.PHONY : edit_cache/fast
+
+# Special rule for the target test
+test:
+	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running tests..."
+	/usr/bin/ctest --force-new-ctest-process $(ARGS)
+.PHONY : test
+
+# Special rule for the target test
+test/fast: test
+.PHONY : test/fast
+
+# The main all target
+all: cmake_check_build_system
+	cd /workspace/srcdir/mujoco && $(CMAKE_COMMAND) -E cmake_progress_start /workspace/srcdir/mujoco/CMakeFiles /workspace/srcdir/mujoco/simulate//CMakeFiles/progress.marks
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 simulate/all
+	$(CMAKE_COMMAND) -E cmake_progress_start /workspace/srcdir/mujoco/CMakeFiles 0
+.PHONY : all
+
+# The main clean target
+clean:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 simulate/clean
+.PHONY : clean
+
+# The main clean target
+clean/fast: clean
+.PHONY : clean/fast
+
+# Prepare targets for installation.
+preinstall: all
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 simulate/preinstall
+.PHONY : preinstall
+
+# Prepare targets for installation.
+preinstall/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 simulate/preinstall
+.PHONY : preinstall/fast
+
+# clear depends
+depend:
+	cd /workspace/srcdir/mujoco && $(CMAKE_COMMAND) -P /workspace/srcdir/mujoco/CMakeFiles/VerifyGlobs.cmake
+	cd /workspace/srcdir/mujoco && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 1
+.PHONY : depend
+
+# Convenience name for target.
+simulate/CMakeFiles/simulate.dir/rule:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 simulate/CMakeFiles/simulate.dir/rule
+.PHONY : simulate/CMakeFiles/simulate.dir/rule
+
+# Convenience name for target.
+simulate: simulate/CMakeFiles/simulate.dir/rule
+.PHONY : simulate
+
+# fast build rule for target.
+simulate/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/simulate.dir/build.make simulate/CMakeFiles/simulate.dir/build
+.PHONY : simulate/fast
+
+# Convenience name for target.
+simulate/CMakeFiles/libsimulate.dir/rule:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 simulate/CMakeFiles/libsimulate.dir/rule
+.PHONY : simulate/CMakeFiles/libsimulate.dir/rule
+
+# Convenience name for target.
+libsimulate: simulate/CMakeFiles/libsimulate.dir/rule
+.PHONY : libsimulate
+
+# fast build rule for target.
+libsimulate/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/libsimulate.dir/build.make simulate/CMakeFiles/libsimulate.dir/build
+.PHONY : libsimulate/fast
+
+# Convenience name for target.
+simulate/CMakeFiles/platform_ui_adapter.dir/rule:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f CMakeFiles/Makefile2 simulate/CMakeFiles/platform_ui_adapter.dir/rule
+.PHONY : simulate/CMakeFiles/platform_ui_adapter.dir/rule
+
+# Convenience name for target.
+platform_ui_adapter: simulate/CMakeFiles/platform_ui_adapter.dir/rule
+.PHONY : platform_ui_adapter
+
+# fast build rule for target.
+platform_ui_adapter/fast:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/platform_ui_adapter.dir/build.make simulate/CMakeFiles/platform_ui_adapter.dir/build
+.PHONY : platform_ui_adapter/fast
+
+__/dist/simulate.res: __/dist/simulate.rc.res
+.PHONY : __/dist/simulate.res
+
+# target to build an object file
+__/dist/simulate.rc.res:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/simulate.dir/build.make simulate/CMakeFiles/simulate.dir/__/dist/simulate.rc.res
+.PHONY : __/dist/simulate.rc.res
+
+glfw_adapter.obj: glfw_adapter.cc.obj
+.PHONY : glfw_adapter.obj
+
+# target to build an object file
+glfw_adapter.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/platform_ui_adapter.dir/build.make simulate/CMakeFiles/platform_ui_adapter.dir/glfw_adapter.cc.obj
+.PHONY : glfw_adapter.cc.obj
+
+glfw_adapter.i: glfw_adapter.cc.i
+.PHONY : glfw_adapter.i
+
+# target to preprocess a source file
+glfw_adapter.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/platform_ui_adapter.dir/build.make simulate/CMakeFiles/platform_ui_adapter.dir/glfw_adapter.cc.i
+.PHONY : glfw_adapter.cc.i
+
+glfw_adapter.s: glfw_adapter.cc.s
+.PHONY : glfw_adapter.s
+
+# target to generate assembly for a file
+glfw_adapter.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/platform_ui_adapter.dir/build.make simulate/CMakeFiles/platform_ui_adapter.dir/glfw_adapter.cc.s
+.PHONY : glfw_adapter.cc.s
+
+glfw_dispatch.obj: glfw_dispatch.cc.obj
+.PHONY : glfw_dispatch.obj
+
+# target to build an object file
+glfw_dispatch.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/platform_ui_adapter.dir/build.make simulate/CMakeFiles/platform_ui_adapter.dir/glfw_dispatch.cc.obj
+.PHONY : glfw_dispatch.cc.obj
+
+glfw_dispatch.i: glfw_dispatch.cc.i
+.PHONY : glfw_dispatch.i
+
+# target to preprocess a source file
+glfw_dispatch.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/platform_ui_adapter.dir/build.make simulate/CMakeFiles/platform_ui_adapter.dir/glfw_dispatch.cc.i
+.PHONY : glfw_dispatch.cc.i
+
+glfw_dispatch.s: glfw_dispatch.cc.s
+.PHONY : glfw_dispatch.s
+
+# target to generate assembly for a file
+glfw_dispatch.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/platform_ui_adapter.dir/build.make simulate/CMakeFiles/platform_ui_adapter.dir/glfw_dispatch.cc.s
+.PHONY : glfw_dispatch.cc.s
+
+main.obj: main.cc.obj
+.PHONY : main.obj
+
+# target to build an object file
+main.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/simulate.dir/build.make simulate/CMakeFiles/simulate.dir/main.cc.obj
+.PHONY : main.cc.obj
+
+main.i: main.cc.i
+.PHONY : main.i
+
+# target to preprocess a source file
+main.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/simulate.dir/build.make simulate/CMakeFiles/simulate.dir/main.cc.i
+.PHONY : main.cc.i
+
+main.s: main.cc.s
+.PHONY : main.s
+
+# target to generate assembly for a file
+main.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/simulate.dir/build.make simulate/CMakeFiles/simulate.dir/main.cc.s
+.PHONY : main.cc.s
+
+platform_ui_adapter.obj: platform_ui_adapter.cc.obj
+.PHONY : platform_ui_adapter.obj
+
+# target to build an object file
+platform_ui_adapter.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/platform_ui_adapter.dir/build.make simulate/CMakeFiles/platform_ui_adapter.dir/platform_ui_adapter.cc.obj
+.PHONY : platform_ui_adapter.cc.obj
+
+platform_ui_adapter.i: platform_ui_adapter.cc.i
+.PHONY : platform_ui_adapter.i
+
+# target to preprocess a source file
+platform_ui_adapter.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/platform_ui_adapter.dir/build.make simulate/CMakeFiles/platform_ui_adapter.dir/platform_ui_adapter.cc.i
+.PHONY : platform_ui_adapter.cc.i
+
+platform_ui_adapter.s: platform_ui_adapter.cc.s
+.PHONY : platform_ui_adapter.s
+
+# target to generate assembly for a file
+platform_ui_adapter.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/platform_ui_adapter.dir/build.make simulate/CMakeFiles/platform_ui_adapter.dir/platform_ui_adapter.cc.s
+.PHONY : platform_ui_adapter.cc.s
+
+simulate.obj: simulate.cc.obj
+.PHONY : simulate.obj
+
+# target to build an object file
+simulate.cc.obj:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/libsimulate.dir/build.make simulate/CMakeFiles/libsimulate.dir/simulate.cc.obj
+.PHONY : simulate.cc.obj
+
+simulate.i: simulate.cc.i
+.PHONY : simulate.i
+
+# target to preprocess a source file
+simulate.cc.i:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/libsimulate.dir/build.make simulate/CMakeFiles/libsimulate.dir/simulate.cc.i
+.PHONY : simulate.cc.i
+
+simulate.s: simulate.cc.s
+.PHONY : simulate.s
+
+# target to generate assembly for a file
+simulate.cc.s:
+	cd /workspace/srcdir/mujoco && $(MAKE) $(MAKESILENT) -f simulate/CMakeFiles/libsimulate.dir/build.make simulate/CMakeFiles/libsimulate.dir/simulate.cc.s
+.PHONY : simulate.cc.s
+
+# Help Target
+help:
+	@echo "The following are some of the valid targets for this Makefile:"
+	@echo "... all (the default if no target is provided)"
+	@echo "... clean"
+	@echo "... depend"
+	@echo "... edit_cache"
+	@echo "... install"
+	@echo "... install/local"
+	@echo "... install/strip"
+	@echo "... list_install_components"
+	@echo "... rebuild_cache"
+	@echo "... test"
+	@echo "... libsimulate"
+	@echo "... platform_ui_adapter"
+	@echo "... simulate"
+	@echo "... __/dist/simulate.res"
+	@echo "... glfw_adapter.obj"
+	@echo "... glfw_adapter.i"
+	@echo "... glfw_adapter.s"
+	@echo "... glfw_dispatch.obj"
+	@echo "... glfw_dispatch.i"
+	@echo "... glfw_dispatch.s"
+	@echo "... main.obj"
+	@echo "... main.i"
+	@echo "... main.s"
+	@echo "... platform_ui_adapter.obj"
+	@echo "... platform_ui_adapter.i"
+	@echo "... platform_ui_adapter.s"
+	@echo "... simulate.obj"
+	@echo "... simulate.i"
+	@echo "... simulate.s"
+.PHONY : help
+
+
+
+#=============================================================================
+# Special targets to cleanup operation of make.
+
+# Special rule to run CMake to check the build system integrity.
+# No rule that depends on this can have commands that come from listfiles
+# because they might be regenerated.
+cmake_check_build_system:
+	cd /workspace/srcdir/mujoco && $(CMAKE_COMMAND) -P /workspace/srcdir/mujoco/CMakeFiles/VerifyGlobs.cmake
+	cd /workspace/srcdir/mujoco && $(CMAKE_COMMAND) -S$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 0
+.PHONY : cmake_check_build_system
 
-all:
-	$(CXX) $(COMMON) -std=c++17 -c simulate.cc
-	$(CC)  $(COMMON) -std=c11   -c uitools.c
-	$(CXX) $(COMMON) -std=c++17 main.cc simulate.o uitools.o -lmujoco -lglfw -o ../bin/simulate
-	rm uitools.o simulate.o
diff --git a/src/engine/engine_crossplatform.h b/src/engine/engine_crossplatform.h
index a73d892..8a3d4d0 100644
--- a/src/engine/engine_crossplatform.h
+++ b/src/engine/engine_crossplatform.h
@@ -18,10 +18,14 @@
 #include <stdlib.h>
 
 // Windows
-#ifdef _WIN32
+#if defined(_WIN32) && !defined(__MINGW32__) && !defined(__MINGW64__)
   #define strcasecmp _stricmp
   #define strncasecmp _strnicmp
+#else
+  #include <strings.h>
+#endif
 
+#if defined(_WIN32)
   #define mjQUICKSORT(buf, elnum, elsz, func, context) \
       qsort_s(buf, elnum, elsz, func, context)
   #define quicksortfunc(name, context, el1, el2) \
@@ -29,16 +33,12 @@
 
 // Unix-common
 #else
-  #include <strings.h>
-
   // Apple
   #ifdef __APPLE__
     #define mjQUICKSORT(buf, elnum, elsz, func, context) \
         qsort_r(buf, elnum, elsz, context, func)
     #define quicksortfunc(name, context, el1, el2) \
         static int name(void* context, const void* el1, const void* el2)
-
-  // non-Apple
   #else
     #define mjQUICKSORT(buf, elnum, elsz, func, context) \
         qsort_r(buf, elnum, elsz, func, context)
diff --git a/src/engine/engine_util_errmem.c b/src/engine/engine_util_errmem.c
index 125a64d..6d98872 100644
--- a/src/engine/engine_util_errmem.c
+++ b/src/engine/engine_util_errmem.c
@@ -109,16 +109,18 @@ void mju_writeLog(const char* type, const char* msg) {
 
 #if defined(_POSIX_C_SOURCE) || defined(__APPLE__) || defined(__STDC_VERSION_TIME_H__)
     localtime_r(&rawtime, &timeinfo);
+    fprintf(fp, "%s%s: %s\n\n", asctime(&timeinfo), type, msg);
 #elif _MSC_VER
     localtime_s(&timeinfo, &rawtime);
-#elif __STDC_LIB_EXT1__
+    fprintf(fp, "%s%s: %s\n\n", asctime(&timeinfo), type, msg);
+#elif __STDC_LIB_EXT1__ 
     localtime_s(&rawtime, &timeinfo);
+    fprintf(fp, "%s%s: %s\n\n", asctime(&timeinfo), type, msg);
 #else
-    #error "Thread-safe version of `localtime` is not present in the standard C library"
+    fprintf(fp, "%s%s: %s\n\n", asctime(localtime(&rawtime)), type, msg);
 #endif
 
     // write to log file
-    fprintf(fp, "%s%s: %s\n\n", asctime(&timeinfo), type, msg);
     fclose(fp);
   }
 }
diff --git a/test/fixture.cc b/test/fixture.cc
index 1043223..c818e3e 100644
--- a/test/fixture.cc
+++ b/test/fixture.cc
@@ -128,7 +128,7 @@ const std::string SaveAndReadXml(const mjModel* model) {
 #if defined(_POSIX_VERSION) && _POSIX_VERSION >= 200112L
   int fd = mkstemp(filepath);
   EXPECT_NE(fd, -1) << std::strerror(errno);
-#elif defined(_WIN32)
+#elif defined(_WIN32) && !defined(__MINGW32__) && !defined(__MINGW32__)
   EXPECT_NE(_mktemp_s(filepath), EINVAL);
 #endif
 
-- 
2.41.0

